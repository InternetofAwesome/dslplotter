<!DOCTYPE html>
<html>
<head>
    <title>AWS SDK for JavaScript - Sample Application</title>
    <meta charset="utf-8">
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.184.0.min.js"></script>
    <script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
</head>

<body>
    <div id="results" style='width: 100%; height: 600px'></div>
    <script type="text/javascript">
        var appId = 'YOUR_APP_ID';
        var roleArn = 'YOUR_ROLE_ARN';
        var bucketName = 'YOUR_BUCKET_NAME';
        AWS.config.region = 'us-west-2';
        AWS.config.accessKeyId = 'AKIAI76FPOWRMOOFOWGA'
        AWS.config.secretAccessKey = 'AWyD/VO1xpk/uCEJeMlDBNoBDvSKHdgvWN2fSTqK'

        var dynamodb = new AWS.DynamoDB({
            params: {
                apiVersion: '2012-08-10',
                // region: 'us-west-2'
            }
        });
        var results = document.getElementById('results');

        google.charts.load('current', {'packages':['annotatedtimeline']});
        google.charts.setOnLoadCallback(drawChart);
        function drawChart(){
            var chart = new google.visualization.AnnotatedTimeLine(results);
            chart.scaleType = 'allmaximized '
            dynamodb.scan({TableName: 'dslplotter'}, function(err, data) {
            if(err)
            {
                console.log('err', err)
                return
            }
            var fdata = new google.visualization.DataTable();
            var keys = ['AttenuationAt300k', 'UpNoiseMargin', 'DnNoiseMargin', 'Precip_1hr_in']
            fdata.addColumn('date', 'timestamp');
            for(k of keys)
            {
                fdata.addColumn('number', k)   
            }
            for (d of data.Items)
            {
                row = [new Date(parseInt(1000*d['timestamp']['N']))]
                for(key of keys)
                {
                    row.push(parseFloat(d[key]['S']))
                }
                fdata.addRow(row)
            }
            chart.scaleType = 'allmaximized'
            chart.draw(fdata, {scaleType: 'allmaximized'});
        })
        }
    </script>
</body>
</html>